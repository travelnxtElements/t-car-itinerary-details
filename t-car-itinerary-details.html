<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../t-image/t-image.html">
<link rel="import" href="../t-shared-lib/t-date-behavior.html">

<dom-module id="t-car-itinerary-details">
    <template>
        <style include="iron-flex"></style>
        <style include="travel-element-styles">
          :host {
            display: block;
            margin: 10px;
            border: solid black thin;
            padding: 5px;
          }
          
          .imageArea {
              width: 100%;
              height: 150px;
              margin: 10px 0 10px 0;
          }
          
          .imageArea t-image {
              width: 100%;
              height: 100%;
          }
          
          .logoArea {
              width: 50px;
              height: 20px;
              position: relative;
          }
          
          .logoArea t-image {
              width: 100%;
              height: 100%;
          }
        </style>
        <div class="imageArea">
            <t-image src="[[itinerary.heroImageUrl]]"></t-image>
        </div>
        <br>
        <div><b>[[itinerary.name]]</b></div>
        <br>
        <div><b>[[itinerary.category]]</b></div>
        <br>
        <div class="logoArea">
            <t-image src="[[itinerary.brand.logo]]"></t-image>
        </div>
        <br>
        <div>[[itinerary.capacity]]</div>
        <div>[[itinerary.baggage]]</div>
        <div>[[itinerary.airConditioning]]</div>
        <div>[[itinerary.transmission]]</div>
        <div>[[itinerary.doors]]</div>
        <br>        
        <div><b>pick-up from</b></div>
        <div><b>Date - </b>[[pickupDate]]</div>
        <div>[[pickupAddress]]</div>
        <br>
        <div><b>drop-off to</b></div>
        <div><b>Date - </b>[[dropoffDate]]</div>
        <div>[[dropoffAddress]]</div>
        <br>
        <a href="#">policy</a>
        <br>        
        <br>        
        <t-faredetails 
          id="fareDetails"
          is-collapsible
          itinerary-fare-label="Car Rental"></t-faredetails>
    </template>
    <script>
      Polymer({

          is: 't-car-itinerary-details',

          behaviors: [
              TravelNxt.Behaviors.DateBehavior
          ],

          observers : [
              '_onItineraryUpdate(itinerary, searchCriteria)'
          ],

          properties: {

              itinerary: {
                  type: Object
              },

              searchCriteria: {
                  type: Object
              },

              pickupDate: {
                  type: String
              },

              dropoffDate: {
                  type: String
              },

              pickupAddress: {
                  type: String
              },

              dropoffAddress: {
                  type: String
              }
          },

          _onItineraryUpdate: function(itinerary, searchCriteria) {
              if (!itinerary || !searchCriteria) {
                  return;
              }

              this._setDetails();

              this.$.fareDetails.data = itinerary && itinerary.fare 
                                      ? itinerary.fare.components 
                                      : null;
          },

          _setDetails: function () {
              if (!this.itinerary || !this.searchCriteria) {
                  return;
              }

              this.pickupAddress = this.itinerary.pickupInfo.address;

              this.dropoffAddress = this.itinerary.pickupInfo.address === this.itinerary.dropoffInfo.address 
                                  ? 'Same as pickup' 
                                  : this.itinerary.dropoffInfo.address;
              
              var formattedDate = this._getDateComponents(this.searchCriteria.pickupDate);
              this.pickupDate = formattedDate.date  + ' ' + formattedDate.shortMonth + ' ' + this.searchCriteria.pickupTime;
              
              formattedDate = this._getDateComponents(this.searchCriteria.dropoffDate);
              this.dropoffDate = formattedDate.date + ' ' + formattedDate.shortMonth + ' ' + this.searchCriteria.dropoffTime;

              this.$.fareDetails.baseFareLabel = 'Avg. per day rate x ' + this._dateDiff(this.pickupDate, this.dropoffDate);

          }

      });
    </script>
</dom-module>
